# Kademuliaについて
<hr>
<br>
* **距離はXOR**
<br>
* **kBucketでRootingTableを構築**
<br>

<hr>

 Torrentで採用されているDHTは、「Kademulia」と呼ばれているものです。本章では、KademuliaのなかでもkBucketを用いたRootingTableについて紹介して行きます。
 
###  XORで距離を定義する。
 前章で説明した通り、DHTでは距離を定義する必要がありました。Kademuliaでは、この距離にxorを利用します。xorの距離とはどのようなものでしょうか?具体的にみていきましょう。

　コンピュータプログラムでは、数字を2進数で表現できる事はご存じてじょうか。2進数とは、1と0のみで数字を表す方法の事で、256は二進数で、11111111 と表現できます。同様に、1 は 00000001、2は00000010、3は00000011、5は、0000101と表現できます。
 例えば、00000011を10進数にもどす場合は、「1 + (0×2) + (1×(2×2))=5」と計算します。同様に10進数に戻す場合は、00000010は、「0+ (1×2)=2」と計算できます。
 
 XOR距離は、この2進数に直した値にxorをする事をいいます。AとBの xor距離をとる事を、 A ^ B と書く事にしましょう。
 
 ますば、xorとは何か?　与えられ値の何れかが、1の時、1となる計算方法のことです。
 
| 値A | 値B | A ^ B |
| -- | -- |-- |
| 1  |  1 | 0 |
| 1  |  0 | 1 |
| 0  | 1  | 1 |
| 0  | 0  | 0 |

　これを、おのおの桁ごとに計算していきます。
「256(11111111) ^ 3(00000011) --> 252 (11111100)」、同様に「252 (11111100) ^ 256(11111111) --> 3(00000011)」といった感じで計算できます。


##### xorは対称距離
xorは、A ^ B と　B ^ A は同じ値になります。例えば、「256(11111111) ^ 3(00000011) --> 252 (11111100)」「 3(00000011)　^ 256(11111111) --> 252 (11111100)」といった感じです。

xorを距離として使うと、Peer間の距離が、お互いに同じになります。
これは。 Peer A から見た Peer B も Peer B から見た Peer A も同じ距離になるわけです。

これと、kBucket の RootingTable が合わさるともっと、綺麗な特徴が見えてきます。


### kBucket の RootingTableを利用している
前章で、DHTでは各PeerがPeerの一覧を持っいると説明しました。そして、その一覧には偏りがあり自分に近いPeerについてはより詳しいのでした。Kademuliaでは、kBucketのRootingTableでPeerの一覧を管理しています。
kBucketは、K個のPeerの情報をグローピングする入れ物です。それだけです。K個以上保持する事ができないので、それ以上のPeerを追加するには、kBucketから不要なPeerを削除する必要があります。

Kademulia の RootingTableは、0〜160の161個のkBucketを所持する事ができます。それぞれのkBucketは、Peerからの距離が、2の0乗より小さい、2の1乗より小さい、2の2乗より小さい.....2の160乗より小さい値を所持する事がでます。

ちょっと複雑ですね。具体的に見ていきましょう。

##### 距離に応じて

















